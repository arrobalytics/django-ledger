{% extends 'django_ledger/base.html' %}
{% load i18n %}
{% load static %}
{% load django_ledger %}

{% block content %}

    <section class="hero is-primary is-bold">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">{% trans 'Financial Overview' %}</h1>
                <h2 class="subtitle">
                    <span class="icon"><i class="icon mdi mdi-domain"></i></span>{{ entity.name }}</h2>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="columns is-multiline">

                <div class="column is-6-tablet">
                    <div class="box content djetler-box-green">
                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Assets' %}</h2>
                        <h1 class="has-text-centered">${{ tx_digest.group_balance.GROUP_ASSETS | cs_thousands }}</h1>
                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Liabilities' %}</h2>
                        <h1 class="has-text-centered">
                            ${{ tx_digest.group_balance.GROUP_LIABILITIES | cs_thousands }}</h1>
                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Equity' %}</h2>
                        <h1 class="has-text-centered">${{ tx_digest.group_balance.GROUP_EQUITY | cs_thousands }}</h1>
                        <h4 class="has-text-centered has-text-weight-light">{% trans 'Cash' %}</h4>
                        <h3 class="has-text-centered">${{ tx_digest.role_balance.ASSET_CA_CASH | cs_thousands }}</h3>
                    </div>
                </div>

                <div class="column is-6-tablet">
                    <div class="box content djetler-box-yellow">
                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Revenue' %}</h2>
                        <h1 class="has-text-centered">${{ tx_digest.group_balance.GROUP_INCOME | cs_thousands }}</h1>
                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Expenses' %}</h2>
                        <h1 class="has-text-centered">
                            ${{ tx_digest.group_balance.GROUP_EXPENSES | reverse_sing | cs_thousands }}</h1>
                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Earnings (Loss)' %}</h2>
                        <h1 class="has-text-centered">${{ tx_digest.group_balance.GROUP_EARNINGS | cs_thousands }}</h1>
                        <h4 class="has-text-centered has-text-weight-light">{% trans 'As Of' %}</h4>
                        <h3 class="has-text-centered">{{ date_filter | date }}</h3>
                    </div>
                </div>

                <div class="column is-12">
                    {% pnl_chart pnl_chart_id %}
                </div>
            </div>
        </div>
    </section>

    <section class="hero is-primary is-bold">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">{% trans 'Payables' %}</h1>
                <h2 class="subtitle">
                    <span class="icon"><i class="icon mdi mdi-domain"></i></span>{{ entity.name }}</h2>
            </div>
        </div>
    </section>

    <section class="section">

        <div class="container">
            <div class="columns is-multiline is-centered">
                <div class="column is-8-tablet is-6-desktop">
                    {% payables_chart payables_chart_id %}
                </div>
                {% for bill in bills %}
                    <div class="column is-6-tablet is-4-desktop">
                        <div class="card">
                            <div class="card-content">
                                <p class="subtitle has-text-grey-lighter has-text-right">
                                    <span class="icon is-medium"><i
                                            class="mdi mdi-24px mdi-credit-card-outline is-medium"></i></span>Bill</p>
                                <p class="title has-text-weight-light">{{ bill.bill_to }}</p>
                                <p class="subtitle">{{ bill.address_1 }}</p>
                                {% if not bill.is_past_due %}
                                    <p class="is-size-4 has-text-info">Due in: {{ bill.due_date | timeuntil }}</p>
                                {% else %}
                                    <p class="has-text-danger has-text-weight-bold is-size-4">Past
                                        Due: {{ bill.due_date | timesince }} ago</p>
                                {% endif %}

                                {% if bill.progressible %}
                                    <p>Is Progressible: <span class="icon has-text-success"><i
                                            class="mdi mdi-18px mdi-check-circle"></i></span></p>
                                {% else %}
                                    <p>Is Progressible: <span class="icon has-text-danger"><i
                                            class="mdi mdi-18px mdi-do-not-disturb"></i></span>
                                    </p>
                                {% endif %}
                                <p class="is-size-5">Amount Open: ${{ bill.get_amount_open | cs_thousands }}</p>
                                <p>Amount Paid: ${{ bill.amount_paid | cs_thousands }}</p>
                                <p>Progressed: {{ bill.get_progress | percentage }}</p>


                                {#                                <p>Is Progressible: {% if bill.progressible %}#}
                                {#                                    <span class="icon has-text-success"><i#}
                                {#                                            class="mdi mdi-18px mdi-check-circle"></i></span>#}
                                {#                                {% else %}#}
                                {#                                    <span class="icon has-text-danger"><i#}
                                {#                                            class="mdi mdi-18px mdi-do-not-disturb"></i></span>#}
                                {#                                {% endif %} </p>#}
                            </div>
                            <footer class="card-footer">
                                <a href="{% url 'django_ledger:bill-update' entity_slug=view.kwargs.entity_slug bill_pk=bill.uuid %}"
                                   class="card-footer-item">Details</a>
                                <a href="{{ entity.get_manage_url }}" class="card-footer-item">Details</a>
                                <a href="#" class="card-footer-item">Void</a>
                            </footer>
                        </div>
                    </div>

                {% endfor %}

                <div class="column is-6-tablet is-4-desktop has-text-centered">
                    <div class="box">
                        <a href="{% url 'django_ledger:bill-create' entity_slug=view.kwargs.entity_slug %}">
                            <span class="icon is-large">
                                <i class="mdi mdi-48px mdi-plus-circle-outline"
                                   style="color: #929292;"></i></span></a>
                        <h2 class="is-size-3">{% trans 'New Bill' %}</h2>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <section class="hero is-primary is-bold">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">Receivables</h1>
                <h2 class="subtitle">
                    <span class="icon"><i class="icon mdi mdi-domain"></i></span>{{ entity.name }}</h2>
            </div>
        </div>
    </section>


    <section class="section">
        <div class="container">
            <div class="tile is-ancestor">
                <div class="tile is-vertical is-8">
                    <div class="tile">


                        <div class="tile is-parent is-vertical">
                            <div class="tile is-child box content">
                                <h2 class="has-text-centered has-text-weight-light">{% trans 'Insights' %}</h2>
                                <p>Future place for cool stuff.</p>
                                <div id="djetler-vue">[[message]]</div>
                            </div>
                            <div class="tile is-child box content">
                                <h3 class="has-text-weight-light has-text-centered">Financial Analysis</h3>

                                <h4>Solvency:</h4>
                                <ul>
                                    <li>Current Ratio: {{ tx_digest.ratios.current_ratio }}</li>
                                    <li>Quick Ratio: {{ tx_digest.ratios.quick_ratio }}</li>
                                </ul>

                                <h4>Leverage:</h4>
                                <ul>
                                    <li>Debt to Equity: {{ tx_digest.ratios.debt_to_equity }}</li>
                                </ul>

                                <h4>Profitability:</h4>
                                <ul>
                                    <li>ROE: {{ tx_digest.ratios.return_on_equity }}</li>
                                    <li>ROA: {{ tx_digest.ratios.return_on_assets }}</li>
                                    <li>Net Profit Margin: {{ tx_digest.ratios.net_profit_margin }}</li>
                                    <li>Gross Profit Margin: {{ tx_digest.ratios.gross_profit_margin }}</li>
                                </ul>


                            </div>
                        </div>
                    </div>

                </div>
                <div class="tile is-parent">
                    <div class="tile is-child box content">
                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Chart of Accounts' %}</h2>
                        <a class="button is-primary is-outlined is-fullwidth djetler_my_1"
                           href="{% url 'django_ledger:account-list' entity_slug=entity.slug coa_slug=entity.coa.slug %}">Accounts</a>
                        <a class="button is-primary is-outlined is-fullwidth"
                           href="{{ entity.coa.get_update_url }}">CoA Settings</a>

                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Ledgers' %}</h2>
                        <a class="button is-primary is-outlined is-fullwidth"
                           href="{% url 'django_ledger:ledger-list' entity_slug=view.kwargs.entity_slug %}">Ledgers</a>


                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Actions' %}</h2>
                        <a class="button is-primary is-outlined is-fullwidth djetler_my_1"
                           href="{% url 'django_ledger:invoice-list' entity_slug=view.kwargs.entity_slug %}">Invoices</a>
                        <a class="button is-primary is-outlined is-fullwidth djetler_my_1"
                           href="{% url 'django_ledger:bill-list' entity_slug=view.kwargs.entity_slug %}">Bills</a>

                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Reports' %}</h2>
                        <a class="button is-primary is-outlined is-fullwidth djetler_my_1"
                           href="{% url 'django_ledger:entity-bs' entity_slug=view.kwargs.entity_slug %}">Balance
                            Sheet</a>
                        <a class="button is-primary is-outlined is-fullwidth djetler_my_1"
                           href="{% url 'django_ledger:entity-ic' entity_slug=view.kwargs.entity_slug %}">Income
                            Statement</a>

                        <h2 class="has-text-centered has-text-weight-light">{% trans 'Entity' %}</h2>
                        <a class="button is-info is-outlined is-fullwidth djetler_my_1"
                           href="{% url 'django_ledger:bank-account-list' entity_slug=view.kwargs.entity_slug %}">Bank
                            Accounts</a>
                        <a class="button is-danger is-outlined is-fullwidth djetler_my_1"
                           href="{% url 'django_ledger:data-import-jobs-list' entity_slug=view.kwargs.entity_slug %}">Import</a>
                        <a class="button is-info is-outlined is-fullwidth djetler_my_1"
                           href="{% url 'django_ledger:entity-manage' entity_slug=view.kwargs.entity_slug %}">Manage</a>
                        <a class="button is-info is-outlined is-fullwidth djetler_my_1"
                           href="{% url 'django_ledger:entity-generate-sample-data' entity_slug=view.kwargs.entity_slug %}">Sample
                            Data</a>

                    </div>
                </div>
            </div>
        </div>


    </section>

{% endblock %}

{% block script_bottom %}
    {{ block.super }}
    <script>
        djLedger.renderPnLChart("{{ pnl_chart_id }}", "{{ view.kwargs.entity_slug }}")
        djLedger.renderNetPayablesChart("{{ payables_chart_id }}", "{{ view.kwargs.entity_slug }}")
    </script>
{% endblock %}


